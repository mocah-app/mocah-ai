// stripe.prisma
// Better Auth Stripe Plugin Models
// These models are managed by Better Auth's Stripe plugin
// We extend them with our custom fields and relations

model Subscription {
  id                     String   @id @map("_id")
  plan                   String   // Plan name (e.g., "free", "starter", "pro", "scale")
  referenceId            String   @unique // User ID or Organization ID
  stripeCustomerId       String?
  stripeSubscriptionId   String?
  status                 String   @default("incomplete") // Stripe status: trialing, active, canceled, incomplete, etc.
  periodStart            DateTime?
  periodEnd              DateTime?
  cancelAtPeriodEnd      Boolean  @default(false)
  seats                  Int?
  
  // Trial period tracking (from Stripe)
  trialStart             DateTime?
  trialEnd               DateTime?
  
  // Trial usage tracking (during trial period)
  trialTemplatesUsed     Int      @default(0)  // Templates generated during trial
  trialImagesUsed        Int      @default(0)  // Images generated during trial
  
  // Trial outcome tracking
  trialConverted         Boolean  @default(false)  // True if trial successfully converted to paid
  trialConvertedAt       DateTime?  // When trial converted to active subscription
  trialCancelled         Boolean  @default(false)  // True if cancelled during trial
  trialCancelledAt       DateTime?  // When cancelled during trial
  
  // Metadata
  createdAt              DateTime?
  updatedAt              DateTime?

  // Note: referenceId can point to either User or Organization
  // Better Auth manages this relationship
  // Invoices are fetched from Stripe API when needed

  @@index([referenceId])
  @@index([status])
  @@index([stripeSubscriptionId])
  @@index([periodEnd])
  @@index([trialEnd]) // For querying expiring trials
  @@map("subscription")
}

